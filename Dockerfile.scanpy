# Example Dockerfile for custom Scanpy container with all dependencies
# Build with: docker build -f Dockerfile.scanpy -t myorg/scanpy:custom .
# Use with: nextflow run main.nf --scanpy_image myorg/scanpy:custom

FROM quay.io/biocontainers/scanpy:1.9.6--pyhdfd78af_0

# Install additional Python dependencies
RUN pip install --no-cache-dir \
    bbknn \
    rpy2

# Install R base and BiocManager
RUN apt-get update && apt-get install -y \
    r-base \
    r-base-dev \
    && rm -rf /var/lib/apt/lists/*

# Install scDblFinder
RUN R --slave -e "install.packages('BiocManager', repos='http://cran.r-project.org'); \
                  library(BiocManager); \
                  BiocManager::install('scDblFinder')"

# Verify installations
RUN python -c "import scanpy; import bbknn; import rpy2; print('All Python dependencies OK')"
RUN R --slave -e "library(scDblFinder); print('scDblFinder OK')"
